<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FERREMAS - Detalle del Producto</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body { 
      font-family: 'Roboto', sans-serif; 
      scroll-behavior: smooth;
    }
    /* Estilos para el contenedor de toasts (copiados de catalogo.html) */
    #toast-container {
      position: fixed;
      top: 1.5rem; /* 24px */
      right: 1.5rem; /* 24px */
      z-index: 9999;
      display: flex;
      flex-direction: column;
      gap: 0.75rem; /* 12px */
    }
    .toast {
      padding: 1rem 1.5rem; /* 16px 24px */
      border-radius: 0.5rem; /* 8px */
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      opacity: 0;
      transition: opacity 0.3s ease-out, transform 0.3s ease-out;
      transform: translateX(100%); /* Inicia fuera de la pantalla a la derecha */
    }
    .toast.show {
      opacity: 1;
      transform: translateX(0);
    }
    .toast.success {
      background-color: #48bb78; /* green-500 */
      color: white;
    }
    .toast.error {
      background-color: #f56565; /* red-500 */
      color: white;
    }
    .toast.info {
      background-color: #4299e1; /* blue-500 */
      color: white;
    }
  </style>
</head>
<body class="bg-gray-100 text-gray-800 flex flex-col min-h-screen">

  <!-- Header para Cliente Logueado (Similar al Catálogo) -->
  <header class="bg-white shadow-lg sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
      <a href="../index.html" class="text-3xl font-bold text-orange-600 hover:text-orange-700 transition-colors">FERREMAS</a>
      <nav class="space-x-4 text-sm font-medium flex items-center">
        <a href="catalogo.html" class="text-gray-700 hover:text-orange-600 transition-colors">Catálogo</a>
        <a href="mis_pedidos.html" class="text-gray-700 hover:text-orange-600 transition-colors hidden md:inline">Mis Pedidos</a>
        <a href="carrito.html" class="text-gray-700 hover:text-orange-600 transition-colors relative hidden md:inline">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
          </svg>
          <span id="cartItemCount" class="absolute -top-2 -right-2 bg-orange-600 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">0</span>
        </a>
        <div class="relative group">
            <span id="nombreUsuario" class="text-gray-700 cursor-pointer hover:text-orange-600">Invitado</span>
            <!-- Podríamos añadir un dropdown aquí con más opciones si el usuario está logueado -->
        </div>
        <button id="btnLogout" class="px-4 py-2 bg-red-500 text-white rounded-lg shadow hover:bg-red-600 transition-colors">Cerrar Sesión</button>
      </nav>
    </div>
  </header>

  <!-- Contenido Principal - Detalle del Producto -->
  <main class="flex-grow container mx-auto px-4 py-8">
    <div id="productDetailContainer" class="bg-white shadow-xl rounded-lg p-6 md:p-8 animate-fade-in">
      <!-- Aquí se cargará el detalle del producto -->
      <p class="text-center text-gray-600 py-10 text-xl">Cargando detalle del producto...</p>
    </div>

    <!-- Botón o enlace para volver al catálogo -->
    <div class="mt-8 text-center">
        <a href="catalogo.html" class="inline-block text-orange-600 hover:text-orange-700 font-semibold transition-colors">
            &larr; Volver al Catálogo
        </a>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-gray-900 text-white py-6 mt-auto">
    <div class="max-w-7xl mx-auto px-4 text-center">
      <p class="text-sm">&copy; 2025 FERREMAS. Todos los derechos reservados.</p>
      <p class="text-xs mt-1">Diseñado con <span class="text-orange-400">&hearts;</span> para tus proyectos.</p>
    </div>
  </footer>

  <!-- Contenedor para Toasts/Notificaciones -->
  <div id="toast-container"></div>

  <script>
    // Configuración de Tailwind para animaciones personalizadas (si es necesaria)
    tailwind.config = {
      theme: {
        extend: {
          animation: {
            'fade-in': 'fadeIn 1s ease-out',
          },
          keyframes: {
            fadeIn: {
              '0%': { opacity: 0 },
              '100%': { opacity: 1 }
            }
          }
        }
      }
    };

    document.addEventListener('DOMContentLoaded', function() {
      // --- Lógica del Header (Cerrar Sesión, Nombre Usuario) ---
      const nombreUsuarioEl = document.getElementById('nombreUsuario');
      const cartItemCountEl_Header_Detail = document.getElementById('cartItemCount'); // Específico para esta página
      const btnLogout = document.getElementById('btnLogout');
      const userName = localStorage.getItem('userName');
      const authToken = localStorage.getItem('authToken');

      if (authToken && userName) {
        if (nombreUsuarioEl) nombreUsuarioEl.textContent = `Hola, ${userName}`;
        if (btnLogout) btnLogout.classList.remove('hidden');
      } else {
        if (nombreUsuarioEl) nombreUsuarioEl.textContent = 'Invitado';
        if (btnLogout) btnLogout.classList.add('hidden');
        // Considerar redirigir a login si esta página requiere autenticación obligatoria
        // window.location.href = '../login.html'; 
      }

      if (btnLogout) {
        btnLogout.addEventListener('click', function() {
          localStorage.removeItem('authToken');
          localStorage.removeItem('userRole');
          localStorage.removeItem('userName');
          localStorage.removeItem('ferremasCart'); // Limpiar carrito al cerrar sesión
          window.location.href = '../login.html';
        });
      }

      // --- Lógica del Carrito (replicada para consistencia) ---
      function getCartFromStorage() {
        return JSON.parse(localStorage.getItem('ferremasCart')) || [];
      }

      function saveCartToStorage(cart) {
        localStorage.setItem('ferremasCart', JSON.stringify(cart));
        updateCartCountInHeader_Detail(cart);
      }

      function updateCartCountInHeader_Detail(cart) {
        const currentCart = cart || getCartFromStorage();
        if (cartItemCountEl_Header_Detail) {
          cartItemCountEl_Header_Detail.textContent = currentCart.reduce((total, item) => total + item.quantity, 0);
        }
      }

      // Actualizar el contador del carrito en el header al cargar la página
      updateCartCountInHeader_Detail();
      // --- Fin Lógica del Carrito ---

      // --- Lógica para Toasts/Notificaciones (copiada de catalogo.html) ---
      const toastContainer = document.getElementById('toast-container');

      function showToast(message, type = 'info', duration = 3000) {
        if (!toastContainer) return;

        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        toast.textContent = message;
        
        toastContainer.appendChild(toast);

        requestAnimationFrame(() => {
          toast.classList.add('show');
        });

        setTimeout(() => {
          toast.classList.remove('show');
          setTimeout(() => toast.remove(), 300);
        }, duration);
      }
      // --- Fin Lógica para Toasts ---

      // --- Lógica para cargar el Detalle del Producto ---
      const productDetailContainer = document.getElementById('productDetailContainer');
      const selectedProductId = localStorage.getItem('selectedProductId'); // Obtener el ID guardado

      // TODO: En una aplicación real, aquí harías una llamada a tu API de backend
      // para obtener los detalles del producto usando el selectedProductId.
      // fetch(`/api/products/${selectedProductId}/`)
      //   .then(response => response.json())
      //   .then(producto => {
      //     renderizarDetalleProducto(producto);
      //   })
      //   .catch(error => {
      //     console.error('Error al cargar detalle del producto:', error);
      //     productDetailContainer.innerHTML = '<p class="text-center text-red-600 py-10 text-xl">Error al cargar el producto.</p>';
      //   });

      // --- Simulación: Usar los mismos datos de productos del catálogo ---
      // Esto es solo para que la página funcione visualmente sin el backend.
      // En la integración real, eliminarías este array y la búsqueda local.
      const todosLosProductosSimulados = [
         { id: "P001", nombre: "Taladro Percutor Bosch Pro", sku: "BOSCH-TP-PRO-001", categoria: "herramientas", descripcion: "Máxima potencia y durabilidad para profesionales. Motor de 850W, mandril de 13mm. Incluye empuñadura auxiliar y medidor de profundidad.", precioCLP: 129990, stock: 15, imagen: "../assets/taladro.jpg", alt: "Taladro Percutor Bosch Profesional", oferta: true },
         { id: "P002", nombre: "Juego Destornilladores Stanley 6pz", sku: "STANLEY-DS-006", categoria: "manuales", descripcion: "Juego de 6 destornilladores con puntas magnéticas de cromo vanadio. Mangos ergonómicos de doble material para mayor comodidad y torque. Incluye organizador.", precioCLP: 24990, stock: 30, imagen: "../assets/Jgo.-de-destornilladores-STANLEY-6-pzas.-STHT69170-1.png", alt: "Juego de Destornilladores Stanley" },
         { id: "P003", nombre: "Cinta Métrica Profesional 5m", sku: "PRO-CM-005", categoria: "manuales", descripcion: "Cinta métrica de 5 metros con carcasa ABS de alta resistencia. Cinta de acero con recubrimiento de nylon para mayor durabilidad. Freno de cinta y clip para cinturón.", precioCLP: 9990, stock: 50, imagen: "../assets/d_nq_np_2x_820651-mlc40854154766_022020-f-8cff2697-107e-4579-baa7-b830d0424250.jpg", alt: "Cinta Métrica Profesional 5m" },
         { id: "P004", nombre: "Martillo Carpintero Mango Fibra", sku: "PRO-MART-001", categoria: "manuales", descripcion: "Martillo de carpintero con cabeza de acero forjado de alta calidad. Mango de fibra de vidrio con recubrimiento de goma para absorción de vibraciones y agarre seguro.", precioCLP: 12990, stock: 22, imagen: "../assets/martillo.png", alt: "Martillo Profesional Mango Fibra" },
         { id: "P005", nombre: "Esmeril Angular 4 1/2 Makita", sku: "MAKITA-EA-004", categoria: "herramientas", descripcion: "Esmeril angular compacto y ligero con potente motor de 720W. Ideal para corte y desbaste. Incluye guarda de seguridad y llave.", precioCLP: 75500, stock: 8, imagen: "../assets/esmeril_angular.jpg", alt: "Esmeril Angular Makita", oferta: true },
         { id: "P006", nombre: "Guantes de Seguridad Anticorte", sku: "SEG-GUAN-010", categoria: "seguridad", descripcion: "Guantes de seguridad con nivel 5 de resistencia al corte. Fabricados con fibras de alta tecnología. Palma recubierta de poliuretano para un agarre excepcional.", precioCLP: 8990, stock: 100, imagen: "../assets/guantes_seguridad.jpg", alt: "Guantes de Seguridad Anticorte" }
      ];

      const productoEncontrado = todosLosProductosSimulados.find(p => p.id === selectedProductId);

      if (productoEncontrado) {
        renderizarDetalleProducto(productoEncontrado);
      } else {
        productDetailContainer.innerHTML = '<p class="text-center text-red-600 py-10 text-xl">Producto no encontrado.</p>';
      }
      // --- Fin Simulación ---

      function renderizarDetalleProducto(producto) {
        const detalleHTML = `
          <div class="flex flex-col md:flex-row gap-8">
            <div class="md:w-1/2 flex justify-center items-center bg-gray-50 rounded-lg p-6">
              <img src="${producto.imagen}" alt="${producto.alt}" class="max-w-full max-h-96 object-contain">
            </div>
            <div class="md:w-1/2 flex flex-col">
              <h2 class="text-3xl font-bold text-gray-900 mb-2">${producto.nombre}</h2>
              <p class="text-sm text-gray-600 mb-4">SKU: ${producto.sku}</p>
              ${producto.oferta ? '<span class="inline-block bg-red-500 text-white text-sm font-semibold px-3 py-1 rounded-full mb-4">OFERTA</span>' : ''}
              
              <p class="text-gray-800 text-lg mb-6">${producto.descripcion}</p>
              
              <div class="mt-auto">
                <p class="font-bold text-orange-600 text-4xl mb-4">$${producto.precioCLP.toLocaleString('es-CL')}</p>
                <p class="text-sm ${producto.stock > 0 ? 'text-green-600' : 'text-red-600'} mb-6">
                  ${producto.stock > 0 ? `Disponible (${producto.stock} unidades)` : 'Agotado'}
                </p>
                
                <button data-product-id="${producto.id}" class="w-full bg-orange-600 hover:bg-orange-700 text-white font-semibold py-3 rounded-lg text-lg transition-colors flex items-center justify-center gap-2 add-to-cart-btn" ${producto.stock <= 0 ? 'disabled' : ''}>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" /></svg>
                    Añadir al Carrito
                </button>
                ${producto.stock <= 0 ? '<p class="text-center text-red-600 text-sm mt-2">Producto temporalmente agotado.</p>' : ''}
              </div>
            </div>
          </div>
        `;
        productDetailContainer.innerHTML = detalleHTML;

        // Añadir event listener al botón "Añadir al Carrito"
        const addToCartBtn = productDetailContainer.querySelector('.add-to-cart-btn');
        if (addToCartBtn) {
            addToCartBtn.addEventListener('click', function() {
                const productId = this.dataset.productId;
                let cart = getCartFromStorage();
                const existingItemIndex = cart.findIndex(item => item.id === productId);
                // El 'producto' ya lo tenemos de 'productoEncontrado'

                if (!productoEncontrado) { // Doble chequeo, aunque ya debería estar cargado
                    showToast('Error: Detalles del producto no disponibles.', 'error');
                    return;
                }

                if (existingItemIndex > -1) {
                    if (cart[existingItemIndex].quantity < productoEncontrado.stock) {
                        cart[existingItemIndex].quantity++;
                        saveCartToStorage(cart);
                        showToast(`"${productoEncontrado.nombre}" añadido al carrito. Cantidad: ${cart[existingItemIndex].quantity}`, 'success');
                    } else {
                        showToast('No puedes añadir más unidades (stock máximo alcanzado).', 'info');
                        return;
                    }
                } else {
                    if (productoEncontrado.stock > 0) { cart.push({ id: productId, quantity: 1 }); saveCartToStorage(cart); showToast(`"${productoEncontrado.nombre}" añadido al carrito.`, 'success'); }
                    else { showToast('Este producto está agotado.', 'error'); return; }
                }
            });
        }
      }

      // Limpiar el ID del producto seleccionado de localStorage después de usarlo
      // Esto es opcional, pero evita que la página cargue el mismo producto si se accede directamente después.
      // localStorage.removeItem('selectedProductId');

    });
  </script>
</body>
</html>